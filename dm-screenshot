#!/bin/bash

[ ! "$(command -V "maim")" ] || \
    [ ! "$(command -V "fzf")" ] || \
    [ ! "$(command -V "dmenu")" ] \
    && exit 1

prompt="dmenu -i -l 50"
[ "$2" = "-t" ] && prompt="fzf"

save_path="$HOME/Pictures/Screenshots"

[ ! -d "$save_path" ] && mkdir -p "$save_path"

file_name="screenshot-$(date '+%d-%m-%y@%s').png"

maim_cmd="maim -B -u -f png -m 5 "$save_path/$file_name" --quiet"

prompt="$(printf "%s\n" "1. Take Shot" "2. Section" "3. View Screenshots" | \
    $prompt | tr " " _)"

case ${prompt} in
    1._Take_Shot) $maim_cmd -d 0.2 || exit 1 ;;
    2._Section) $maim_cmd -s || exit 1 ;;
    3._View_Screenshots) sxiv "$save_path" || exit 1 ;;
    *) exit 1;;
esac

[ "$(command -V "notify-send")" ] && [ -f "$save_path/$file_name" ] && \
    notify-send "dm-screenshot" "Screenshot Taken! saved as $file_name"
